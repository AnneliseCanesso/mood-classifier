#################################################
## This script return all tracks feautures ##
## list of all tracks from multiple playlists ##
#################################################

# Get API 
Sys.setenv(SPOTIFY_CLIENT_ID = 'xxx')
Sys.setenv(SPOTIFY_CLIENT_SECRET = 'xxx')

access_token <- get_spotify_access_token

# Get my playlists and filter the ones that we need
# Here the maximum you can get at once is 50 playlists

my_playlist <- get_my_playlists(limit = 50, offset = 0,
                  authorization = get_spotify_authorization_code(),
                                   include_meta_info = FALSE)


#excluding my own playlists 
# right now we don't need it, because  we are just calling the last 50
 
#sad_playlist <- my_playlist %>%
  #filter(!name %in% c("Sad Songs\U0001f614", "Por Do CÃ©u \U0001f340")) 


# Get only the playlist ID

my_playlist_id <- my_playlist$id

# Get all tracks from the playlists
  # This will create a list of lists

tracks <- lapply(my_playlist_id, function(x) { 
  get_playlist_tracks(x, authorization = get_spotify_access_token()) 
})

# Getting just the Track_id
# Again another list of list 

tracks_id <- lapply(tracks, "[", 16)
sad_id <- unlist(tracks_id, use.names = F) # list with all track ID's


# Get the tracks variable  from the playlist - test

print(sad_id);
#sad_data <- data.frame(x = rnorm(1000), y = runif(18))
for (i in sad_id) { # access the list 
  for (j in i) { # access the second list /  
    n <-  get_track_audio_features(j)
    print(n) # I am working here will use rbind probably to create the actual Data frame with all tracks variables
}
